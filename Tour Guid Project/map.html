
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<meta charset="utf-8">
<link rel="stylesheet" href="stylemap.css">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
<title>Waypoints in directions</title>
</head>
<body>
	<div id="map"></div>
	<div id="right-panel">
		<div>
			<b>Start:</b> <select id="start">
				<option value="Halifax, NS">Halifax, NS</option>
				<option value="Boston, MA">Boston, MA</option>
				<option value="New York, NY">New York, NY</option>
				<option value="Miami, FL">Miami, FL</option>
			</select> <br> <b>Waypoints:</b> <br> <i>(Ctrl+Click or
				Cmd+Click for multiple selection)</i> <br> <select multiple
				id="waypoints">
				<option value="montreal, quebec">Montreal, QBC</option>
				<option value="toronto, ont">Toronto, ONT</option>
				<option value="chicago, il">Chicago</option>
				<option value="winnipeg, mb">Winnipeg</option>
				<option value="fargo, nd">Fargo</option>
				<option value="calgary, ab">Calgary</option>
				<option value="spokane, wa">Spokane</option>
			</select> <br> <b>End:</b> <select id="end">
				<option value="Vancouver, BC">Vancouver, BC</option>
				<option value="Seattle, WA">Seattle, WA</option>
				<option value="San Francisco, CA">San Francisco, CA</option>
				<option value="Los Angeles, CA">Los Angeles, CA</option>
			</select> <br> <input type="submit" id="submit">
		</div>
		<div id="directions-panel"></div>
	</div>
	<script>
		var liveLat, liveLong;
		function initMap() {
			var directionsService = new google.maps.DirectionsService;
			var directionsDisplay = new google.maps.DirectionsRenderer;
			var map = new google.maps.Map(document.getElementById('map'), {
				center : {
					lat : 17.3850,
					lng : 78.4867
				},
				zoom : 15,
				mapTypeId : google.maps.MapTypeId.ROADMAP
			});
			infoWindow = new google.maps.InfoWindow;
			// Try HTML5 geolocation.
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(function(position) {
					var pos = {
						lat : position.coords.latitude,
						lng : position.coords.longitude
					};
					liveLat = position.coords.latitude;
					liveLong = position.coords.longitude;
					//infoWindow.setPosition(pos);
					//infoWindow.setContent('Location found.');
					infoWindow.open(map);
					console.log(pos);
					map.setCenter(pos);
				}, function() {
					handleLocationError(true, infoWindow, map.getCenter());
				});
			} else {
				// Browser doesn't support Geolocation
				handleLocationError(false, infoWindow, map.getCenter());
			}

			directionsDisplay.setMap(map);

			document.getElementById('submit').addEventListener(
					'click',
					function() {
						calculateAndDisplayRoute(directionsService,
								directionsDisplay);
					});
		}

		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
			infoWindow.setPosition(pos);
			infoWindow
					.setContent(browserHasGeolocation ? 'Error: The Geolocation service failed.'
							: 'Error: Your browser doesn\'t support geolocation.');
			infoWindow.open(map);
		}

		function calculateAndDisplayRoute(directionsService, directionsDisplay) {
			var waypts = [];
			var checkboxArray = document.getElementById('waypoints');
			for (var i = 0; i < checkboxArray.length; i++) {
				if (checkboxArray.options[i].selected) {
					waypts.push({
						location : new google.maps.LatLng(12.9716, 77.5946),
						stopover : true
					});
				}
			}

			directionsService.route({
				origin : new google.maps.LatLng(liveLat, liveLong),
				destination : new google.maps.LatLng(liveLat, liveLong),
				waypoints : waypts,
				optimizeWaypoints : true,
				travelMode : 'DRIVING'
			}, function(response, status) {
				if (status === 'OK') {
					directionsDisplay.setDirections(response);
					var route = response.routes[0];
					var summaryPanel = document
							.getElementById('directions-panel');
					summaryPanel.innerHTML = '';
					// For each route, display summary information.
					for (var i = 0; i < route.legs.length; i++) {
						var routeSegment = i + 1;
						summaryPanel.innerHTML += '<b>Route Segment: '
								+ routeSegment + '</b><br>';
						summaryPanel.innerHTML += route.legs[i].start_address
								+ ' to ';
						summaryPanel.innerHTML += route.legs[i].end_address
								+ '<br>';
						summaryPanel.innerHTML += route.legs[i].distance.text
								+ '<br><br>';
					}
				} else {
					window.alert('Directions request failed due to ' + status);
				}
			});
		}
	</script>
	<script async defer
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBAoKQLHah3tfC-Hq0ikM4np-LDwptN2Y&callback=initMap">
		
	</script>
</body>
</html>